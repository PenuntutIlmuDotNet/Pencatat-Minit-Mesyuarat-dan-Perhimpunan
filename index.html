<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pencatatan Minit Mesyuarat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-2 sm:px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">📝 Sistem Pencatatan Minit</h1>
            <p class="text-blue-100 text-lg">Mesyuarat & Perhimpunan Sekolah</p>
            
            <!-- Facebook Follow Button -->
            <div class="mt-6">
                <a href="https://www.facebook.com/saifulsamat142/" target="_blank" rel="noopener noreferrer" 
                   class="inline-flex items-center bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full font-semibold transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    <span class="animate-pulse">👍</span>
                    <span class="ml-1">Follow Kami untuk Inovasi Terbaru!</span>
                </a>
            </div>
        </div>

        <!-- Meeting Type Selection -->
        <div id="meetingTypeSelection" class="max-w-2xl mx-auto mb-8">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Pilih Jenis Minit</h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <button id="selectMesyuarat" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-xl hover:from-blue-700 hover:to-blue-800 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        <div class="text-4xl mb-3">🏢</div>
                        <h3 class="text-xl font-semibold mb-2">Minit Mesyuarat</h3>
                        <p class="text-blue-100 text-sm">Untuk mesyuarat rasmi sekolah</p>
                    </button>
                    <button id="selectPerhimpunan" class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 rounded-xl hover:from-purple-700 hover:to-purple-800 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        <div class="text-4xl mb-3">👥</div>
                        <h3 class="text-xl font-semibold mb-2">Minit Perhimpunan</h3>
                        <p class="text-purple-100 text-sm">Untuk perhimpunan sekolah</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Form -->
        <div id="mainForm" class="max-w-4xl mx-auto px-2 sm:px-0 bg-white rounded-2xl shadow-2xl overflow-hidden hidden">
            <div id="formHeader" class="bg-gradient-to-r from-blue-600 to-purple-600 p-4 sm:p-6">
                <h2 class="text-2xl font-semibold text-white flex items-center">
                    <span class="mr-3">🎯</span>
                    <span id="formTitle">Borang Pencatatan Ucapan</span>
                </h2>
            </div>

            <!-- Back to Selection Button -->
            <div class="p-4 sm:p-6 border-b border-gray-200">
                <button type="button" id="backToSelectionBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg flex items-center transition-colors border border-gray-300 shadow-sm">
                    <span class="mr-2">←</span>
                    Kembali ke Pilihan Jenis Minit
                </button>
            </div>

            <form id="meetingForm" class="p-4 sm:p-8 space-y-6">
                <!-- Row 1: Guru & Masa -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            👨‍🏫 Nama Guru Yang Berucap
                        </label>
                        <input type="text" id="speakerName" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ⏰ Masa
                        </label>
                        <input type="time" id="time" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                </div>

                <!-- Row 2: Tarikh & Hari -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            📅 Tarikh
                        </label>
                        <input type="date" id="date" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            📆 Hari
                        </label>
                        <select id="day" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">Pilih Hari</option>
                            <option value="Isnin">Isnin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Khamis">Khamis</option>
                            <option value="Jumaat">Jumaat</option>
                            <option value="Sabtu">Sabtu</option>
                            <option value="Ahad">Ahad</option>
                        </select>
                    </div>
                </div>

                <!-- Nama Pencatat -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ✍️ Nama Pencatat
                    </label>
                    <input type="text" id="recorderName" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                </div>

                <!-- Catatan Ucapan -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        📝 Catatan Ucapan
                    </label>
                    <textarea id="speechNotes" required rows="8"
                              placeholder="Tulis catatan ucapan di sini..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"></textarea>
                    <div class="text-sm text-gray-500 mt-1">
                        <span id="charCount">0</span> aksara
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-4">
                    <button type="submit" id="submitBtn"
                            class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        💾 Simpan Catatan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 transform scale-95 transition-transform">
            <div class="text-center">
                <div class="text-6xl mb-4">✅</div>
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Catatan Berjaya Disimpan!</h3>
                <p class="text-gray-600 mb-6">Maklumat telah dihantar ke Google Sheets</p>
                
                <div class="space-y-3">
                    <button id="shareWhatsApp" 
                            class="w-full bg-green-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-600 transition-colors flex items-center justify-center">
                        <span class="mr-2">📱</span>
                        Kongsi ke WhatsApp Group
                    </button>
                    
                    <button id="generatePDF"
                            class="w-full bg-red-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-600 transition-colors flex items-center justify-center">
                        <span class="mr-2">📄</span>
                        Muat Turun PDF
                    </button>
                    
                    <button id="backToSelection"
                            class="w-full bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        🔄 Pilih Jenis Minit Lain
                    </button>
                    
                    <button id="closeModal"
                            class="w-full bg-gray-300 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-400 transition-colors">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-40">
        <div class="bg-white rounded-lg p-6 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-700">Menyimpan data ke Google Sheets...</p>
        </div>
    </div>

    <script>
        // Global variables to store form data
        let currentFormData = {};
        let selectedMeetingType = ''; // 'mesyuarat' or 'perhimpunan'

        // Google Apps Script Web App URL - SUDAH DIKEMAS KINI
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwhdNtMHwX4exLEnLywhxQd46I8m_Lo4iJovz0DGTixdo6MXkzFzp3G7y0b-Dxin15L/exec';

        // Meeting type selection handlers
        document.getElementById('selectMesyuarat').addEventListener('click', function() {
            selectedMeetingType = 'mesyuarat';
            setupForm('mesyuarat');
        });

        document.getElementById('selectPerhimpunan').addEventListener('click', function() {
            selectedMeetingType = 'perhimpunan';
            setupForm('perhimpunan');
        });

        function setupForm(type) {
            // Hide selection screen and show form
            document.getElementById('meetingTypeSelection').classList.add('hidden');
            document.getElementById('mainForm').classList.remove('hidden');
            
            // Update form styling and text based on type
            const formHeader = document.getElementById('formHeader');
            const formTitle = document.getElementById('formTitle');
            
            if (type === 'mesyuarat') {
                formHeader.className = 'bg-gradient-to-r from-blue-600 to-blue-700 p-4 sm:p-6';
                formTitle.innerHTML = '🏢 Borang Pencatatan Ucapan Mesyuarat';
            } else {
                formHeader.className = 'bg-gradient-to-r from-purple-600 to-purple-700 p-4 sm:p-6';
                formTitle.innerHTML = '👥 Borang Pencatatan Ucapan Perhimpunan';
            }
            
            // Set current date and time
            const now = new Date();
            document.getElementById('date').value = now.toISOString().split('T')[0];
            document.getElementById('time').value = now.toTimeString().slice(0, 5);
            
            // Auto-set day based on date
            const days = ['Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'];
            document.getElementById('day').value = days[now.getDay()];
        }

        // Set current date and time
        document.addEventListener('DOMContentLoaded', function() {
            // Initial setup is now handled by meeting type selection
        });

        // Character counter for textarea
        document.getElementById('speechNotes').addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length;
        });

        // Auto-update day when date changes
        document.getElementById('date').addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const days = ['Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'];
            document.getElementById('day').value = days[selectedDate.getDay()];
        });

        // Form submission
        document.getElementById('meetingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            currentFormData = {
                meetingType: selectedMeetingType,
                speakerName: document.getElementById('speakerName').value,
                time: document.getElementById('time').value,
                date: document.getElementById('date').value,
                day: document.getElementById('day').value,
                recorderName: document.getElementById('recorderName').value,
                speechNotes: document.getElementById('speechNotes').value,
                timestamp: new Date().toISOString()
            };

            // Show loading
            document.getElementById('loadingOverlay').classList.remove('hidden');
            document.getElementById('loadingOverlay').classList.add('flex');

            // Submit to Google Sheets
            submitToGoogleSheets(currentFormData);
        });

        function submitToGoogleSheets(data) {
            // Submit to Google Sheets via Apps Script
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                // Hide loading and show success
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('loadingOverlay').classList.remove('flex');
                showSuccessModal();
            })
            .catch((error) => {
                console.error('Error:', error);
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('loadingOverlay').classList.remove('flex');
                alert('Ralat semasa menyimpan data. Sila cuba lagi.');
            });
        }

        function showSuccessModal() {
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successModal').classList.add('flex');
            
            // Reset form
            document.getElementById('meetingForm').reset();
            document.getElementById('charCount').textContent = '0';
            
            // Reset date and time to current
            const now = new Date();
            document.getElementById('date').value = now.toISOString().split('T')[0];
            document.getElementById('time').value = now.toTimeString().slice(0, 5);
            const days = ['Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'];
            document.getElementById('day').value = days[now.getDay()];
        }

        // WhatsApp sharing
        document.getElementById('shareWhatsApp').addEventListener('click', function() {
            const message = formatWhatsAppMessage(currentFormData);
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        });

        function formatWhatsAppMessage(data) {
            const meetingTypeText = data.meetingType === 'mesyuarat' ? 'MESYUARAT' : 'PERHIMPUNAN';
            const icon = data.meetingType === 'mesyuarat' ? '🏢' : '👥';
            
            return `📝 *CATATAN MINIT ${meetingTypeText}*

${icon} *Guru:* ${data.speakerName}
📅 *Tarikh:* ${data.date} (${data.day})
⏰ *Masa:* ${data.time}
✍️ *Pencatat:* ${data.recorderName}

📝 *Catatan Ucapan:*
${data.speechNotes}

---
_Dihantar melalui Sistem Pencatatan Minit ${meetingTypeText.charAt(0) + meetingTypeText.slice(1).toLowerCase()}_`;
        }

        // PDF Generation - Real PDF File
        document.getElementById('generatePDF').addEventListener('click', function() {
            generateRealPDF(currentFormData);
        });

        function generateRealPDF(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const meetingTypeText = data.meetingType === 'mesyuarat' ? 'Mesyuarat' : 'Perhimpunan';
                const icon = data.meetingType === 'mesyuarat' ? '🏢' : '👥';
                
                // Set font
                doc.setFont("helvetica");
                
                // Header
                doc.setFontSize(18);
                doc.setFont("helvetica", "bold");
                doc.text(`CATATAN MINIT ${meetingTypeText.toUpperCase()}`, 105, 25, { align: 'center' });
                
                doc.setFontSize(14);
                doc.setFont("helvetica", "normal");
                doc.text(`${meetingTypeText} Sekolah`, 105, 35, { align: 'center' });
                
                // Line separator
                doc.setLineWidth(0.5);
                doc.line(20, 45, 190, 45);
                
                // Content
                let yPos = 60;
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                
                // Meeting details
                doc.text(`Guru Yang Berucap:`, 25, yPos);
                doc.setFont("helvetica", "normal");
                doc.text(data.speakerName, 80, yPos);
                yPos += 10;
                
                doc.setFont("helvetica", "bold");
                doc.text(`Tarikh:`, 25, yPos);
                doc.setFont("helvetica", "normal");
                doc.text(`${data.date} (${data.day})`, 80, yPos);
                yPos += 10;
                
                doc.setFont("helvetica", "bold");
                doc.text(`Masa:`, 25, yPos);
                doc.setFont("helvetica", "normal");
                doc.text(data.time, 80, yPos);
                yPos += 10;
                
                doc.setFont("helvetica", "bold");
                doc.text(`Nama Pencatat:`, 25, yPos);
                doc.setFont("helvetica", "normal");
                doc.text(data.recorderName, 80, yPos);
                yPos += 20;
                
                // Speech notes section
                doc.setFont("helvetica", "bold");
                doc.setFontSize(14);
                doc.text(`CATATAN UCAPAN:`, 25, yPos);
                yPos += 15;
                
                // Add speech notes with text wrapping
                doc.setFont("helvetica", "normal");
                doc.setFontSize(11);
                
                const speechLines = doc.splitTextToSize(data.speechNotes, 160);
                
                // Check if content fits on one page
                if (yPos + (speechLines.length * 6) > 270) {
                    // Add new page if needed
                    for (let i = 0; i < speechLines.length; i++) {
                        if (yPos > 270) {
                            doc.addPage();
                            yPos = 25;
                        }
                        doc.text(speechLines[i], 25, yPos);
                        yPos += 6;
                    }
                } else {
                    doc.text(speechLines, 25, yPos);
                    yPos += speechLines.length * 6;
                }
                
                // Footer
                yPos = Math.max(yPos + 20, 250);
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 25;
                }
                
                doc.setLineWidth(0.3);
                doc.line(20, yPos, 190, yPos);
                yPos += 10;
                
                doc.setFontSize(10);
                doc.setFont("helvetica", "italic");
                const currentDateTime = new Date().toLocaleString('ms-MY', {
                    timeZone: 'Asia/Kuala_Lumpur',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                doc.text(`Dijana pada: ${currentDateTime}`, 105, yPos, { align: 'center' });
                doc.text(`Sistem Pencatatan Minit ${meetingTypeText}`, 105, yPos + 8, { align: 'center' });
                
                // Generate filename
                const fileName = `Minit_${meetingTypeText}_${data.speakerName.replace(/\s+/g, '_')}_${data.date}.pdf`;
                
                // Generate base64 string for Kodular/MIT App Inventor
                var base64string = doc.output('datauristring');
                
                // Check if running in Kodular/MIT App Inventor WebViewer
                if (typeof Kodular !== 'undefined') {
                    // Send base64 string to Kodular app
                    Kodular.PostWebMessage(JSON.stringify({
                        type: 'pdf_generated',
                        fileName: fileName,
                        base64Data: base64string,
                        meetingType: meetingTypeText,
                        speakerName: data.speakerName,
                        date: data.date
                    }));
                    
                    // Show success message for app users
                    alert(`📱 PDF telah dihantar ke aplikasi!\n\n📄 Nama fail: ${fileName}\n✅ Aplikasi akan memproses fail PDF ini.`);
                    
                } else if (typeof AppInventor !== 'undefined') {
                    // Send base64 string to MIT App Inventor
                    AppInventor.setWebViewString(JSON.stringify({
                        type: 'pdf_generated',
                        fileName: fileName,
                        base64Data: base64string,
                        meetingType: meetingTypeText,
                        speakerName: data.speakerName,
                        date: data.date
                    }));
                    
                    // Show success message for app users
                    alert(`📱 PDF telah dihantar ke aplikasi MIT!\n\n📄 Nama fail: ${fileName}\n✅ Aplikasi akan memproses fail PDF ini.`);
                    
                } else {
                    // Regular web browser - download normally
                    doc.save(fileName);
                    
                    // Show success message for web users
                    setTimeout(() => {
                        alert(`📄 Fail PDF "${fileName}" telah berjaya dimuat turun!\n\n✅ Sila semak folder Download anda untuk fail PDF yang lengkap.`);
                    }, 500);
                }
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('❌ Ralat menjana PDF. Sila cuba lagi atau gunakan butang cetak sebagai alternatif.');
            }
        }

        function showPrintableVersion(data) {
            const meetingTypeText = data.meetingType === 'mesyuarat' ? 'Mesyuarat' : 'Perhimpunan';
            const icon = data.meetingType === 'mesyuarat' ? '🏢' : '👥';
            const headerColor = data.meetingType === 'mesyuarat' ? '#007bff' : '#6f42c1';
            
            const printContent = `
                <!DOCTYPE html>
                <html lang="ms">
                <head>
                    <meta charset="UTF-8">
                    <title>Catatan Minit ${meetingTypeText} - ${data.speakerName}</title>
                    <style>
                        body { 
                            font-family: 'Times New Roman', serif; 
                            padding: 40px; 
                            line-height: 1.8; 
                            color: #333;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        .header { 
                            text-align: center;
                            border-bottom: 3px solid #333; 
                            padding-bottom: 20px; 
                            margin-bottom: 40px; 
                        }
                        .header h1 {
                            font-size: 24px;
                            margin: 0;
                            text-transform: uppercase;
                            letter-spacing: 2px;
                        }
                        .field { 
                            margin-bottom: 20px; 
                            display: flex;
                            align-items: flex-start;
                        }
                        .label { 
                            font-weight: bold; 
                            color: #333; 
                            min-width: 180px;
                            margin-right: 20px;
                        }
                        .value {
                            flex: 1;
                        }
                        .notes { 
                            background: #f8f9fa; 
                            padding: 25px; 
                            border-left: 5px solid ${headerColor}; 
                            margin: 30px 0; 
                            border-radius: 5px;
                        }
                        .notes-content {
                            white-space: pre-wrap;
                            font-size: 14px;
                            line-height: 1.6;
                        }
                        .footer { 
                            margin-top: 50px; 
                            font-size: 12px; 
                            color: #666; 
                            border-top: 1px solid #ddd; 
                            padding-top: 20px; 
                            text-align: center;
                        }
                        .print-instructions {
                            background: #e3f2fd;
                            padding: 20px;
                            border-radius: 8px;
                            margin-bottom: 30px;
                            text-align: center;
                            border: 2px dashed #2196f3;
                        }
                        .print-instructions h3 {
                            color: #1976d2;
                            margin-top: 0;
                        }
                        .btn {
                            background: #007bff;
                            color: white;
                            padding: 12px 24px;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 16px;
                            margin: 0 10px;
                        }
                        .btn:hover {
                            background: #0056b3;
                        }
                        @media print { 
                            body { margin: 0; padding: 20px; }
                            .print-instructions { display: none; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-instructions no-print">
                        <h3>📄 Dokumen Sedia Untuk Dicetak</h3>
                        <p>Klik butang di bawah untuk mencetak atau simpan sebagai PDF:</p>
                        <button class="btn" onclick="window.print()">🖨️ Cetak / Simpan PDF</button>
                        <button class="btn" onclick="window.close()" style="background: #6c757d;">❌ Tutup</button>
                    </div>
                    
                    <div class="header">
                        <h1>${icon} Catatan Minit ${meetingTypeText}</h1>
                        <p style="margin: 10px 0 0 0; font-style: italic;">${meetingTypeText} Sekolah</p>
                    </div>
                    
                    <div class="field">
                        <div class="label">${icon} Guru Yang Berucap:</div>
                        <div class="value">${data.speakerName}</div>
                    </div>
                    
                    <div class="field">
                        <div class="label">📅 Tarikh:</div>
                        <div class="value">${data.date} (${data.day})</div>
                    </div>
                    
                    <div class="field">
                        <div class="label">⏰ Masa:</div>
                        <div class="value">${data.time}</div>
                    </div>
                    
                    <div class="field">
                        <div class="label">✍️ Nama Pencatat:</div>
                        <div class="value">${data.recorderName}</div>
                    </div>
                    
                    <div class="notes">
                        <div class="label" style="margin-bottom: 15px; font-size: 16px;">📝 Catatan Ucapan:</div>
                        <div class="notes-content">${data.speechNotes}</div>
                    </div>
                    
                    <div class="footer">
                        <p><strong>Dijana pada:</strong> ${new Date().toLocaleString('ms-MY', {
                            timeZone: 'Asia/Kuala_Lumpur',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}</p>
                        <p style="margin-top: 10px;"><em>Sistem Pencatatan Minit ${meetingTypeText}</em></p>
                    </div>
                </body>
                </html>
            `;
            
            // Open in new window
            const newWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
            if (newWindow) {
                newWindow.document.write(printContent);
                newWindow.document.close();
                
                // Auto-focus the new window
                newWindow.focus();
            } else {
                alert('Sila benarkan pop-up untuk membuka dokumen cetak.');
            }
        }

        // Back to selection from form
        document.getElementById('backToSelectionBtn').addEventListener('click', function() {
            document.getElementById('mainForm').classList.add('hidden');
            document.getElementById('meetingTypeSelection').classList.remove('hidden');
            selectedMeetingType = '';
            // Reset form
            document.getElementById('meetingForm').reset();
            document.getElementById('charCount').textContent = '0';
        });

        // Back to selection from modal
        document.getElementById('backToSelection').addEventListener('click', function() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
            document.getElementById('mainForm').classList.add('hidden');
            document.getElementById('meetingTypeSelection').classList.remove('hidden');
            selectedMeetingType = '';
        });

        // Close modal
        document.getElementById('closeModal').addEventListener('click', function() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
        });

        // Close modal when clicking outside
        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
                this.classList.remove('flex');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'984d43acd272e454',t:'MTc1ODgzMjA2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
