<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pencatatan Minit Mesyuarat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">üìù Sistem Pencatatan Minit</h1>
            <p class="text-blue-100 text-lg">Mesyuarat & Perhimpunan Sekolah</p>
        </div>

        <!-- Main Form -->
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-6">
                <h2 class="text-2xl font-semibold text-white flex items-center">
                    <span class="mr-3">üéØ</span>
                    Borang Pencatatan Ucapan
                </h2>
            </div>

            <form id="meetingForm" class="p-8 space-y-6">
                <!-- Row 1: Guru & Masa -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üë®‚Äçüè´ Nama Guru Yang Berucap
                        </label>
                        <input type="text" id="speakerName" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ‚è∞ Masa
                        </label>
                        <input type="time" id="time" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                </div>

                <!-- Row 2: Tarikh & Hari -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üìÖ Tarikh
                        </label>
                        <input type="date" id="date" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üìÜ Hari
                        </label>
                        <select id="day" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">Pilih Hari</option>
                            <option value="Isnin">Isnin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Khamis">Khamis</option>
                            <option value="Jumaat">Jumaat</option>
                            <option value="Sabtu">Sabtu</option>
                            <option value="Ahad">Ahad</option>
                        </select>
                    </div>
                </div>

                <!-- Nama Pencatat -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ‚úçÔ∏è Nama Pencatat
                    </label>
                    <input type="text" id="recorderName" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                </div>

                <!-- Catatan Ucapan -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        üìù Catatan Ucapan
                    </label>
                    <textarea id="speechNotes" required rows="8"
                              placeholder="Tulis catatan ucapan di sini..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"></textarea>
                    <div class="text-sm text-gray-500 mt-1">
                        <span id="charCount">0</span> aksara
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-4">
                    <button type="submit" id="submitBtn"
                            class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        üíæ Simpan Catatan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 transform scale-95 transition-transform">
            <div class="text-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Catatan Berjaya Disimpan!</h3>
                <p class="text-gray-600 mb-6">Maklumat telah dihantar ke Google Sheets</p>
                
                <div class="space-y-3">
                    <button id="shareWhatsApp" 
                            class="w-full bg-green-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-600 transition-colors flex items-center justify-center">
                        <span class="mr-2">üì±</span>
                        Kongsi ke WhatsApp Group
                    </button>
                    
                    <button id="generatePDF"
                            class="w-full bg-red-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-600 transition-colors flex items-center justify-center">
                        <span class="mr-2">üìÑ</span>
                        Jana PDF
                    </button>
                    
                    <button id="closeModal"
                            class="w-full bg-gray-300 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-400 transition-colors">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-40">
        <div class="bg-white rounded-lg p-6 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-700">Menyimpan data ke Google Sheets...</p>
        </div>
    </div>

    <script>
        // Global variables to store form data
        let currentFormData = {};

        // Google Apps Script Web App URL - SUDAH DIKEMAS KINI
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwhdNtMHwX4exLEnLywhxQd46I8m_Lo4iJovz0DGTixdo6MXkzFzp3G7y0b-Dxin15L/exec';

        // Set current date and time
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            document.getElementById('date').value = now.toISOString().split('T')[0];
            document.getElementById('time').value = now.toTimeString().slice(0, 5);
            
            // Auto-set day based on date
            const days = ['Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'];
            document.getElementById('day').value = days[now.getDay()];
        });

        // Character counter for textarea
        document.getElementById('speechNotes').addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length;
        });

        // Auto-update day when date changes
        document.getElementById('date').addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const days = ['Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'];
            document.getElementById('day').value = days[selectedDate.getDay()];
        });

        // Form submission
        document.getElementById('meetingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            currentFormData = {
                speakerName: document.getElementById('speakerName').value,
                time: document.getElementById('time').value,
                date: document.getElementById('date').value,
                day: document.getElementById('day').value,
                recorderName: document.getElementById('recorderName').value,
                speechNotes: document.getElementById('speechNotes').value,
                timestamp: new Date().toISOString()
            };

            // Show loading
            document.getElementById('loadingOverlay').classList.remove('hidden');
            document.getElementById('loadingOverlay').classList.add('flex');

            // Submit to Google Sheets
            submitToGoogleSheets(currentFormData);
        });

        function submitToGoogleSheets(data) {
            // Submit to Google Sheets via Apps Script
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                // Hide loading and show success
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('loadingOverlay').classList.remove('flex');
                showSuccessModal();
            })
            .catch((error) => {
                console.error('Error:', error);
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('loadingOverlay').classList.remove('flex');
                alert('Ralat semasa menyimpan data. Sila cuba lagi.');
            });
        }

        function showSuccessModal() {
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successModal').classList.add('flex');
            
            // Reset form
            document.getElementById('meetingForm').reset();
            document.getElementById('charCount').textContent = '0';
            
            // Reset date and time to current
            const now = new Date();
            document.getElementById('date').value = now.toISOString().split('T')[0];
            document.getElementById('time').value = now.toTimeString().slice(0, 5);
            const days = ['Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'];
            document.getElementById('day').value = days[now.getDay()];
        }

        // WhatsApp sharing
        document.getElementById('shareWhatsApp').addEventListener('click', function() {
            const message = formatWhatsAppMessage(currentFormData);
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        });

        function formatWhatsAppMessage(data) {
            return `üìù *CATATAN MINIT MESYUARAT*

üë®‚Äçüè´ *Guru:* ${data.speakerName}
üìÖ *Tarikh:* ${data.date} (${data.day})
‚è∞ *Masa:* ${data.time}
‚úçÔ∏è *Pencatat:* ${data.recorderName}

üìù *Catatan Ucapan:*
${data.speechNotes}

---
_Dihantar melalui Sistem Pencatatan Minit_`;
        }

        // PDF Generation
        document.getElementById('generatePDF').addEventListener('click', function() {
            generatePDF(currentFormData);
        });

        function generatePDF(data) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Set font
            doc.setFont('helvetica');

            // Title
            doc.setFontSize(20);
            doc.setTextColor(40, 40, 40);
            doc.text('CATATAN MINIT MESYUARAT', 20, 30);

            // Line under title
            doc.setLineWidth(0.5);
            doc.line(20, 35, 190, 35);

            // Content
            doc.setFontSize(12);
            doc.setTextColor(60, 60, 60);

            let yPosition = 50;
            const lineHeight = 8;

            doc.text(`Guru Yang Berucap: ${data.speakerName}`, 20, yPosition);
            yPosition += lineHeight;

            doc.text(`Tarikh: ${data.date} (${data.day})`, 20, yPosition);
            yPosition += lineHeight;

            doc.text(`Masa: ${data.time}`, 20, yPosition);
            yPosition += lineHeight;

            doc.text(`Nama Pencatat: ${data.recorderName}`, 20, yPosition);
            yPosition += lineHeight * 2;

            doc.text('Catatan Ucapan:', 20, yPosition);
            yPosition += lineHeight;

            // Split long text into multiple lines
            const splitText = doc.splitTextToSize(data.speechNotes, 170);
            doc.text(splitText, 20, yPosition);

            // Footer
            yPosition = 280;
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(`Dijana pada: ${new Date().toLocaleString('ms-MY')}`, 20, yPosition);

            // Save PDF
            const fileName = `Minit_${data.speakerName}_${data.date}.pdf`;
            doc.save(fileName);
        }

        // Close modal
        document.getElementById('closeModal').addEventListener('click', function() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
        });

        // Close modal when clicking outside
        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
                this.classList.remove('flex');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d515cb61e7aecd',t:'MTc1NzU3MTg5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
